openapi: 3.0.3
info:
  title: Pharmacy Management System API
  description: |
    ## ðŸ¥ Há»‡ Thá»‘ng Quáº£n LÃ½ NhÃ  Thuá»‘c (SaaS)
    
    API Backend cho há»‡ thá»‘ng quáº£n lÃ½ nhÃ  thuá»‘c Ä‘a tenant.
    
    ### Roles:
    - **System Admin**: Quáº£n lÃ½ toÃ n há»‡ thá»‘ng (God Mode)
    - **Owner**: Chá»§ nhÃ  thuá»‘c (quáº£n lÃ½ nhiá»u nhÃ  thuá»‘c)
    - **Staff**: NhÃ¢n viÃªn (Manager, Pharmacist, Cashier)
    - **Customer**: KhÃ¡ch hÃ ng (mobile app)
    
    ### Authentication:
    Sá»­ dá»¥ng JWT Bearer Token. ÄÄƒng nháº­p Ä‘á»ƒ láº¥y token, sau Ä‘Ã³ click **Authorize** vÃ  paste token vÃ o.
  version: 1.0.0
  contact:
    name: Pharmacy SaaS Support
    email: support@pharmacy-saas.com

servers:
  - url: http://localhost:3000/api
    description: Development Server
  - url: https://api.pharmacy-saas.com/api
    description: Production Server

tags:
  - name: System Admin
    description: God Mode - Quáº£n lÃ½ Owner vÃ  há»‡ thá»‘ng
  - name: Auth - Owner
    description: ÄÄƒng kÃ½/ÄÄƒng nháº­p Owner
  - name: Auth - Staff
    description: ÄÄƒng kÃ½/ÄÄƒng nháº­p Staff
  - name: Auth - Customer
    description: ÄÄƒng kÃ½/ÄÄƒng nháº­p Customer
  - name: Staff Management
    description: Quáº£n lÃ½ nhÃ¢n viÃªn (Owner only)
  - name: Inventory
    description: Quáº£n lÃ½ kho hÃ ng
  - name: Sales
    description: BÃ¡n hÃ ng & POS
  - name: Purchases
    description: Nháº­p hÃ ng
  - name: Analytics
    description: Thá»‘ng kÃª & BÃ¡o cÃ¡o
  - name: Customers
    description: Quáº£n lÃ½ khÃ¡ch hÃ ng (CRM)
  - name: Catalog
    description: Danh má»¥c thuá»‘c toÃ n há»‡ thá»‘ng
  - name: Notifications
    description: ThÃ´ng bÃ¡o ná»™i bá»™
  - name: Reminders
    description: Nháº¯c uá»‘ng thuá»‘c (Customer)

security:
  - BearerAuth: []

paths:
  # ==================== SYSTEM ADMIN ====================
  /auth/admin/login:
    post:
      tags: [System Admin]
      summary: Login System Admin
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  example: admin@pharmacy-saas.com
                password:
                  type: string
                  example: SuperSecure@2026!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/admin/owners:
    get:
      tags: [System Admin]
      summary: List all Owners
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, ACTIVE, SUSPENDED]
          description: Filter by status
      responses:
        '200':
          description: List of owners
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/OwnerSummary'
                  count:
                    type: integer

  /auth/admin/owners/{id}:
    get:
      tags: [System Admin]
      summary: Get Owner details
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Owner details with pharmacies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OwnerDetail'

  /auth/admin/owners/{id}/approve:
    put:
      tags: [System Admin]
      summary: Approve pending Owner
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                subscriptionExpiry:
                  type: string
                  format: date-time
                  description: Optional expiry date
      responses:
        '200':
          description: Owner approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'

  /auth/admin/owners/{id}/suspend:
    put:
      tags: [System Admin]
      summary: Suspend Owner
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: Policy violation
      responses:
        '200':
          description: Owner suspended

  /auth/admin/owners/{id}/reactivate:
    put:
      tags: [System Admin]
      summary: Reactivate suspended Owner
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Owner reactivated

  # ==================== AUTH - OWNER ====================
  /auth/owners/register:
    post:
      tags: [Auth - Owner]
      summary: Register new Owner
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterOwnerDto'
      responses:
        '201':
          description: Registration successful (status = PENDING)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/owners/login:
    post:
      tags: [Auth - Owner]
      summary: Login Owner
      security: []
      description: Login with Email/Password. Checks if account is ACTIVE.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginDto'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '403':
          description: Account pending or suspended

  # ==================== AUTH - STAFF ====================
  /auth/staff/register:
    post:
      tags: [Auth - Staff]
      summary: Register new Staff (Owner only)
      description: Register staff for a specific pharmacy.
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterStaffDto'
      responses:
        '201':
          description: Staff created

  /auth/staff/login:
    post:
      tags: [Auth - Staff]
      summary: Login Staff
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginDto'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  # ==================== AUTH - CUSTOMER ====================
  /auth/customers/register:
    post:
      tags: [Auth - Customer]
      summary: Register Customer
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterCustomerDto'
      responses:
        '201':
          description: Customer registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/customers/login:
    post:
      tags: [Auth - Customer]
      summary: Login Customer
      security: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [phone]
              properties:
                phone:
                  type: string
                  example: "0901234567"
                password:
                  type: string
      responses:
        '200':
          description: Login successful

  /auth/otp/send:
    post:
      tags: [Auth - Customer]
      summary: Send OTP
      security: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [phone]
              properties:
                phone:
                  type: string
      responses:
        '200':
          description: OTP sent

  /auth/otp/verify:
    post:
      tags: [Auth - Customer]
      summary: Verify OTP
      security: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [phone, otp]
              properties:
                phone:
                  type: string
                otp:
                  type: string
      responses:
        '200':
          description: OTP verified

  /auth/refresh:
    post:
      tags: [Auth - Owner, Auth - Staff, Auth - Customer]
      summary: Refresh Token
      security: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: New tokens returned

  # ==================== STAFF MANAGEMENT ====================
  /auth/staff:
    get:
      tags: [Staff Management]
      summary: List all staff (Owner only)
      responses:
        '200':
          description: Staff list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Staff'

  /auth/staff/{id}:
    patch:
      tags: [Staff Management]
      summary: Update staff
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                role:
                  type: string
                  enum: [MANAGER, PHARMACIST, CASHIER]
                isActive:
                  type: boolean
      responses:
        '200':
          description: Staff updated
    delete:
      tags: [Staff Management]
      summary: Deactivate staff
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Staff deactivated

  # ==================== INVENTORY ====================
  /inventory:
    get:
      tags: [Inventory]
      summary: List inventory items
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: search
          in: query
          schema:
            type: string
        - name: categoryId
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Inventory list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedInventory'
    post:
      tags: [Inventory]
      summary: Create inventory item
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInventoryDto'
      responses:
        '201':
          description: Item created

  /inventory/{id}:
    get:
      tags: [Inventory]
      summary: Get item details
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Item details with batches
    patch:
      tags: [Inventory]
      summary: Update item
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateInventoryDto'
      responses:
        '200':
          description: Item updated
    delete:
      tags: [Inventory]
      summary: Delete item (soft delete)
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Item deleted

  /inventory/{id}/stock:
    post:
      tags: [Inventory]
      summary: Add stock (Batch In)
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddStockDto'
      responses:
        '201':
          description: Stock added

  /inventory/alerts/expiry:
    get:
      tags: [Inventory]
      summary: Get expiring items
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Expiring batches

  /inventory/alerts/stock:
    get:
      tags: [Inventory]
      summary: Get low stock items
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
      responses:
        '200':
          description: Low stock items

  # ==================== SALES ====================
  /sales/orders:
    post:
      tags: [Sales]
      summary: Create new order
      description: Creates order, deducts stock (FIFO), captures cost price
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderDto'
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'

  /sales/invoices/{id}/receipt:
    get:
      tags: [Sales]
      summary: Get receipt data
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Receipt JSON for printing

  # ==================== PURCHASES ====================
  /purchases:
    get:
      tags: [Purchases]
      summary: List purchase invoices
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, CONFIRMED, CANCELLED]
      responses:
        '200':
          description: Purchase invoices list
    post:
      tags: [Purchases]
      summary: Create purchase invoice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePurchaseDto'
      responses:
        '201':
          description: Invoice created

  /purchases/{id}:
    get:
      tags: [Purchases]
      summary: Get invoice details
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Invoice with items

  /purchases/{id}/status:
    patch:
      tags: [Purchases]
      summary: Update status (CONFIRMED adds stock)
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [PENDING, CONFIRMED, CANCELLED]
      responses:
        '200':
          description: Status updated

  # ==================== ANALYTICS ====================
  /analytics/dashboard:
    get:
      tags: [Analytics]
      summary: Get dashboard stats (Cached)
      description: |
        Dashboard data with Redis caching.
        - **TTL**: 30 seconds
        - Response includes `cached: true/false` and `ttl` for transparency
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardData'

  /analytics/revenue-chart:
    get:
      tags: [Analytics]
      summary: Revenue chart data
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - name: days
          in: query
          schema:
            type: integer
            default: 7
      responses:
        '200':
          description: Chart data

  /analytics/profit-loss:
    get:
      tags: [Analytics]
      summary: P&L Report
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - name: startDate
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Profit/Loss report

  /analytics/top-selling:
    get:
      tags: [Analytics]
      summary: Top selling products
      parameters:
        - $ref: '#/components/parameters/PharmacyIdHeader'
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Top products

  # ==================== CUSTOMERS ====================
  /customers:
    get:
      tags: [Customers]
      summary: Search customers
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Name or phone
        - name: page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Customer list
    post:
      tags: [Customers]
      summary: Create customer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCustomerDto'
      responses:
        '201':
          description: Customer created

  /customers/{id}:
    get:
      tags: [Customers]
      summary: Get customer profile
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Customer with health info

  # ==================== CATALOG ====================
  /catalog:
    get:
      tags: [Catalog]
      summary: List global medicines
      parameters:
        - name: search
          in: query
          schema:
            type: string
        - name: categoryId
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Medicine list
    post:
      tags: [Catalog]
      summary: Create medicine
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCatalogItemDto'
      responses:
        '201':
          description: Medicine created

  /catalog/request-otp:
    post:
      tags: [Catalog]
      summary: Request OTP for Pharma Sales Rep
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  example: rep@supplier.com
      responses:
        '200':
          description: OTP sent to email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'

  /catalog/upload:
    post:
      tags: [Catalog]
      summary: Bulk upload CSV (OTP Verified)
      security: []
      description: |
        Upload a CSV catalog for approval. Requires a valid OTP sent to the rep's email.
        Security: Max 2MB, .csv only, CSV Injection Sanitization applied.
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file, email, otp, supplierId]
              properties:
                file:
                  type: string
                  format: binary
                email:
                  type: string
                otp:
                  type: string
                supplierId:
                  type: string
      responses:
        '201':
          description: Catalog uploaded and pending approval
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      successCount:
                        type: integer
                      errorCount:
                        type: integer
                      errors:
                        type: array
                        items:
                          type: object

  /catalog/pending:
    get:
      tags: [Catalog]
      summary: List pending medicines (Owner only)
      responses:
        '200':
          description: Pending medicine list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/CatalogItem'

  /catalog/approve:
    patch:
      tags: [Catalog]
      summary: Approve catalog items (Owner only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ids]
              properties:
                ids:
                  type: array
                  items:
                    type: string
                  example: ["uuid-1", "uuid-2"]
      responses:
        '200':
          description: Items approved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'

  # ==================== NOTIFICATIONS ====================
  /notifications:
    get:
      tags: [Notifications]
      summary: List notifications
      parameters:
        - name: isRead
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Notification list

  /notifications/unread-count:
    get:
      tags: [Notifications]
      summary: Get unread count
      responses:
        '200':
          description: Count
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer

  /notifications/{id}/read:
    patch:
      tags: [Notifications]
      summary: Mark as read
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Marked as read

  /notifications/read-all:
    patch:
      tags: [Notifications]
      summary: Mark all as read
      responses:
        '200':
          description: All marked as read

  # ==================== REMINDERS ====================
  /reminders:
    get:
      tags: [Reminders]
      summary: List my reminders
      responses:
        '200':
          description: Reminder list
    post:
      tags: [Reminders]
      summary: Create reminder
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReminderDto'
      responses:
        '201':
          description: Reminder created

  /reminders/{id}:
    get:
      tags: [Reminders]
      summary: Get reminder
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Reminder details
    patch:
      tags: [Reminders]
      summary: Update reminder
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Reminder updated
    delete:
      tags: [Reminders]
      summary: Delete reminder
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Reminder deleted

  /reminders/{id}/actions:
    post:
      tags: [Reminders]
      summary: Log action (taken/skipped)
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [actionType]
              properties:
                actionType:
                  type: string
                  enum: [taken, skipped, missed]
                notes:
                  type: string
      responses:
        '201':
          description: Action logged

  /reminders/history:
    get:
      tags: [Reminders]
      summary: Adherence history
      responses:
        '200':
          description: History logs

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Paste JWT token tá»« response login

  parameters:
    IdParam:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: Resource ID

    PharmacyIdHeader:
      name: x-pharmacy-id
      in: header
      required: false
      schema:
        type: string
      description: |
        Pharmacy ID for multi-tenant context.
        Required for Owner accounts with multiple pharmacies.
        Staff accounts auto-detect from their assigned pharmacy.

  schemas:
    # ===== AUTH =====
    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            user:
              type: object
              properties:
                id:
                  type: string
                email:
                  type: string
                name:
                  type: string
                role:
                  type: string
            accessToken:
              type: string
            refreshToken:
              type: string

    LoginDto:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6

    RegisterOwnerDto:
      type: object
      required: [email, password, name]
      properties:
        email:
          type: string
          format: email
          example: owner@pharmacy.com
        password:
          type: string
          minLength: 6
        name:
          type: string
          example: Nguyá»…n VÄƒn A
        phone:
          type: string
          example: "0901234567"

    RegisterStaffDto:
      type: object
      required: [email, password, name, role, pharmacyId]
      properties:
        email:
          type: string
        password:
          type: string
        name:
          type: string
        username:
          type: string
        role:
          type: string
          enum: [MANAGER, PHARMACIST, CASHIER]
        pharmacyId:
          type: string

    RegisterCustomerDto:
      type: object
      required: [phone]
      properties:
        phone:
          type: string
        fullName:
          type: string
        email:
          type: string
        password:
          type: string

    LoginCustomerDto:
      type: object
      required: [phone]
      properties:
        phone:
          type: string
        password:
          type: string
          description: Optional (Password login)
        otp:
          type: string
          description: Optional (OTP login)
      description: Provide either password or otp. w/o password/otp -> Error.

    # ===== OWNER =====
    OwnerSummary:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        name:
          type: string
        phone:
          type: string
        status:
          type: string
          enum: [PENDING, ACTIVE, SUSPENDED]
        subscriptionExpiry:
          type: string
          format: date-time
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        _count:
          type: object
          properties:
            pharmacies:
              type: integer

    OwnerDetail:
      allOf:
        - $ref: '#/components/schemas/OwnerSummary'
        - type: object
          properties:
            pharmacies:
              type: array
              items:
                $ref: '#/components/schemas/PharmacySummary'

    # ===== PHARMACY =====
    PharmacySummary:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        isActive:
          type: boolean

    # ===== STAFF =====
    Staff:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        name:
          type: string
        role:
          type: string
          enum: [MANAGER, PHARMACIST, CASHIER]
        isActive:
          type: boolean
        pharmacyId:
          type: string

    # ===== INVENTORY =====
    InventoryItem:
      type: object
      description: Rich Inventory Data (Units, Batches, Category)
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        categoryId:
          type: string
        brandId:
          type: string
        totalStockLevel:
          type: integer
        minStockLevel:
          type: integer
        isActive:
          type: boolean
        isDeleted:
          type: boolean
        image:
          type: string
        category:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
        units:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              conversionFactor:
                type: integer
              price:
                type: number
              isBaseUnit:
                type: boolean
        batches:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              batchCode:
                type: string
              expiryDate:
                type: string
                format: date-time
              stockQuantity:
                type: integer
        isActive:
          type: boolean
        isDeleted:
          type: boolean

    PaginatedInventory:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/InventoryItem'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer

    CreateInventoryDto:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        categoryId:
          type: string
        brandId:
          type: string
        minStockLevel:
          type: integer
          default: 10

    UpdateInventoryDto:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        minStockLevel:
          type: integer

    AddStockDto:
      type: object
      required: [batchCode, expiryDate, quantity]
      properties:
        batchCode:
          type: string
          example: LOT2026-001
        expiryDate:
          type: string
          format: date
        quantity:
          type: integer
        purchasePrice:
          type: number
          format: float
        purchaseDate:
          type: string
          format: date

    # ===== ORDERS =====
    CreateOrderDto:
      type: object
      required: [items]
      description: |
        **SECURITY**: Server-side pricing applied.
        - Price is fetched from InventoryUnit table, NOT from client
        - unitId must belong to the inventoryId (verified server-side)
        - quantity must be >= 1
      properties:
        customerId:
          type: string
          description: Customer ID (required)
        isPosSale:
          type: boolean
          default: false
          description: True = In-store sale (immediate delivery + payment)
        paymentMethod:
          type: string
          enum: [CASH, TRANSFER, QR]
          default: CASH
        notes:
          type: string
        items:
          type: array
          minItems: 1
          items:
            type: object
            required: [inventoryId, quantity, unitId]
            properties:
              inventoryId:
                type: string
                description: Pharmacy Inventory item ID
              quantity:
                type: integer
                minimum: 1
                description: Quantity (in specified unit, NOT base unit)
              unitId:
                type: string
                description: Unit ID from InventoryUnit table (NOT unit name)

    Order:
      type: object
      properties:
        id:
          type: string
        pharmacyId:
          type: string
        customerId:
          type: string
        totalAmount:
          type: number
        status:
          type: string
        paymentStatus:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'

    OrderItem:
      type: object
      properties:
        id:
          type: string
        inventoryId:
          type: string
        quantity:
          type: integer
        price:
          type: number
        costPrice:
          type: number
          description: Snapshot COGS at sale time

    # ===== PURCHASES =====
    CreatePurchaseDto:
      type: object
      required: [supplierId, items]
      properties:
        supplierId:
          type: string
        invoiceNumber:
          type: string
        invoiceDate:
          type: string
          format: date
        items:
          type: array
          items:
            type: object
            properties:
              inventoryId:
                type: string
              quantity:
                type: integer
              unitPrice:
                type: number

    # ===== ANALYTICS =====
    DashboardData:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            todayRevenue:
              type: number
            todayOrders:
              type: integer
            lowStockCount:
              type: integer
            totalCustomers:
              type: integer
            lowStockItems:
              type: array
              items:
                type: object
            expiringBatches:
              type: array
              items:
                type: object

    # ===== CUSTOMERS =====
    CreateCustomerDto:
      type: object
      required: [phone]
      properties:
        phone:
          type: string
        fullName:
          type: string
        email:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER]

    # ===== CATALOG =====
    CreateCatalogItemDto:
      type: object
      required: [name]
      properties:
        name:
          type: string
        activeIngredient:
          type: string
        dosage:
          type: string
        packaging:
          type: string
        unitPrice:
          type: number
        categoryId:
          type: string
        brandId:
          type: string
        supplierId:
          type: string

    CatalogItem:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        manufacturer:
          type: string
        activeIngredient:
          type: string
        barcode:
          type: string
        unitPrice:
          type: number
        status:
          type: string
          enum: [PENDING, APPROVED, REJECTED]
        category:
          type: object
          properties:
            name:
              type: string
        brand:
          type: object
          properties:
            name:
              type: string
        supplier:
          type: object
          properties:
            name:
              type: string

    # ===== REMINDERS =====
    CreateReminderDto:
      type: object
      required: [medicineName, time]
      properties:
        medicineName:
          type: string
        dosage:
          type: string
        type:
          type: string
          enum: [MEDICATION, SUPPLEMENT, OTHER]
        frequencyType:
          type: string
          enum: [DAILY, SPECIFIC_DAYS, INTERVAL]
        time:
          type: string
          example: "08:00"
        specificDays:
          type: array
          items:
            type: integer
        intervalDays:
          type: integer
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        notes:
          type: string

    # ===== GENERIC =====
    SuccessMessage:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
